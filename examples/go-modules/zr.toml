# Auto-generated by `zr init --detect`
# Detected: Go (go.mod found)

# Base tasks extracted from Go project structure
[tasks.build]
description = "Build the Go project"
cmd = "go build -o bin/gocli"

[tasks.test]
description = "Run Go tests"
cmd = "go test ./..."

[tasks.test-verbose]
description = "Run Go tests with verbose output"
cmd = "go test -v ./..."

[tasks.test-coverage]
description = "Run Go tests with coverage"
cmd = "go test -cover ./..."

[tasks.vet]
description = "Run go vet"
cmd = "go vet ./..."

[tasks.fmt]
description = "Format Go code"
cmd = "go fmt ./..."

[tasks.mod-tidy]
description = "Tidy go.mod dependencies"
cmd = "go mod tidy"

[tasks.run]
description = "Run the Go application"
cmd = "go run main.go"

# Enhanced tasks for development workflow

[tasks.lint]
description = "Run linting checks (vet + fmt check)"
deps = ["vet"]
cmd = "test -z \"$(gofmt -l .)\""

[tasks.install-tools]
description = "Install development tools"
cmd = """
go install golang.org/x/tools/cmd/goimports@latest
go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest
"""

[tasks.golangci-lint]
description = "Run golangci-lint comprehensive checks"
cmd = "golangci-lint run ./..."

[tasks.coverage-html]
description = "Generate HTML coverage report"
cmd = """
go test -coverprofile=coverage.out ./...
go tool cover -html=coverage.out -o coverage.html
echo "Coverage report generated: coverage.html"
"""

[tasks.clean]
description = "Clean build artifacts"
cmd = "rm -rf bin/ coverage.out coverage.html"

[tasks.build-all]
description = "Build for multiple platforms"
cmd = """
GOOS=linux GOARCH=amd64 go build -o bin/gocli-linux-amd64
GOOS=darwin GOARCH=amd64 go build -o bin/gocli-darwin-amd64
GOOS=windows GOARCH=amd64 go build -o bin/gocli-windows-amd64.exe
echo "Built for linux, darwin, and windows"
"""

# Workflows for common operations

[workflows.ci]
description = "Full CI pipeline"
stages = [
    { name = "setup", tasks = ["mod-tidy"] },
    { name = "check", tasks = ["fmt", "vet", "lint"], fail_fast = true },
    { name = "test", tasks = ["test-coverage"] },
    { name = "build", tasks = ["build"] }
]

[workflows.pre-commit]
description = "Pre-commit checks (fast)"
stages = [
    { name = "format", tasks = ["fmt"] },
    { name = "check", tasks = ["vet", "test"], fail_fast = true }
]

[workflows.release]
description = "Release workflow"
stages = [
    { name = "verify", tasks = ["mod-tidy", "test-verbose", "vet"] },
    { name = "build", tasks = ["build-all"] }
]

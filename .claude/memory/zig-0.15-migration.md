# Zig 0.15.x Breaking Changes (from 0.14)

Critical API changes that all agents must follow when writing Zig code.

## Build System

- `addExecutable` now requires `.root_module = b.createModule(.{...})` instead of `.root_source_file`
- `b.createModule()` needs `.root_source_file`, `.target`, `.optimize` fields
- `addTest(.{ .root_module = ... })` instead of `.root_source_file`
- `addStaticLibrary()` removed → use `addLibrary(.{ .linkage = .static, ... })`
- Modules must have explicit target and optimization settings

### build.zig.zon Format

- `.name = .identifier` (enum literal, NOT string)
- `.fingerprint = 0x...` is required and auto-generated by zig build
- `.minimum_zig_version = "0.15.2"` specifies minimum Zig version

## ArrayList → Unmanaged

```zig
// OLD (0.14)
var list = std.ArrayList(u8).init(allocator);
defer list.deinit();
try list.append(42);

// NEW (0.15)
var list: std.ArrayListUnmanaged(u8) = .{};
defer list.deinit(allocator);
try list.append(allocator, 42);
```

**Every mutation method now takes `allocator` as first argument.**

## I/O System

```zig
// OLD (0.14)
const stdout = std.io.getStdOut().writer();
try stdout.print("hello\n", .{});

// NEW (0.15) - Simple output (no formatting)
const stdout = std.fs.File.stdout();
try stdout.writeAll("hello\n");

// NEW (0.15) - Formatted output with buffer
var buf: [4096]u8 = undefined;
var stdout = std.fs.File.stdout();
var writer = stdout.writer(&buf);
defer writer.flush() catch {};
try writer.print("hello {}\n", .{123});
```

**Breaking changes:**
- `std.io.getStdOut()` removed → use `std.fs.File.stdout()`
- For simple output: `stdout.writeAll()`
- For formatted output: need buffer + `.writer(&buf)` + must flush
- Writers are buffered by default in 0.15.1+ (Writergate redesign)

## Type Reflection

- All `std.builtin.Type` tags are lowercase: `.int`, `.float`, `.pointer`
- Reserved words need escaping: `.@"struct"`, `.@"enum"`, `.@"union"`

## Renamed Modules

| Old (0.14) | New (0.15) |
|------------|------------|
| `std.rand` | `std.Random` |
| `std.TailQueue` | `std.DoublyLinkedList` |
| `std.zig.CrossTarget` | `std.Target.Query` |

## Page Size

```zig
// OLD: comptime constant
const page_size = std.mem.page_size;

// NEW: runtime function
const page_size = std.heap.pageSize();
```

## Signal Handling

- Use `.c` calling convention (lowercase) for signal handlers
- `posix.sigaction()` returns void
- Use `std.mem.zeroes(posix.sigset_t)` instead of removed `empty_sigset`

## Cross-Platform / Cross-Compilation

- `std.posix.*` namespace doesn't exist on Windows — all calls must be behind `comptime` guards
- `@extern` for C functions (e.g., `setenv`) does NOT auto-link libc — requires `.link_libc = true` in build.zig
- Zig doesn't bundle MSVC libc — use `.link_libc = if (target.result.os.tag != .windows) true else null`
- `std.posix.getenv` signature: `fn(key: []const u8) ?[:0]const u8` (NOT `[*:0]const u8`)
- `std.process.Child.Id` is platform-specific (pid_t on POSIX, HANDLE on Windows)
- Pattern: centralize POSIX wrappers in a single `platform.zig` with comptime guards
